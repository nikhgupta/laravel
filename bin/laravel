#!/usr/bin/env ruby
# encoding: UTF-8

# resolve bin path, ignoring symlinks
require "pathname"
bin_file = Pathname.new(__FILE__).realpath

# add 'lib' and 'bin' folders to the load path.
$:.unshift File.expand_path(File.join(%w[ .. .. lib]), bin_file)
$:.unshift File.expand_path(File.join(%w[ .. .. bin]), bin_file)

require "laravel" # which indirectly requires 'thor'

# require our commands
require "commands/new"
require "commands/config"
require "commands/install"

module Laravel
  # A means to create and manage applications based on the Laravel
  # framework for PHP. This has a neat command-subcommand structure
  # which imitates Git. This is run when we invoke Laravel over CLI.
  class CLI < Thor

    # choose a default task to run
    default_task :version

    # map some inputs to tasks
    map "-T" => "help", "-C" => "config", "-I" => "install", "-N" => "new"

    # config subcommand that manipulates app configuration
    #
    # +command+ :: subcommand to run.
    #
    desc "config [COMMAND]", "configure an existing application"
    subcommand "config", Laravel::Commands::Config

    # install subcommand that gets us some bundles and goodies
    #
    # +command+ :: subcommand to run.
    #
    desc "install [COMMAND]", "install bundles and other goodies"
    subcommand "install", Laravel::Commands::Install

    # display version information for this gem but is a hidden task,
    # which means that it will not be shown in the 'help' overview.
    #
    # +version+ :: display current Laravel version, aliased as '-v'
    #
    desc "version", "displays usage information about this gem.", :hide => true
    method_option :version, :type => :boolean, :aliases => "-v"
    def version
      puts "Laravel v#{Laravel::VERSION}"
      # puts "Made possible by efforts of Laravel Community"
    end

  end
end

Laravel::CLI.start # starts our CLI application
